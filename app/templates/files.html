{% extends "base.html" %}
{% block content %}
<h2>File Explorer</h2>
<div class="explorer">
    <div id="path"></div>
    <ul id="file-list"></ul>
    <input type="file" id="upload-file">
    <button onclick="upload()">Upload</button>
</div>

<script>
let currentPath = '.';

async function listFiles(path){
    const res = await fetch(`/files/list?path=${encodeURIComponent(path)}`);
    const data = await res.json();
    currentPath = data.path;
    document.getElementById('path').innerText = `Path: ${data.path}`;
    const ul = document.getElementById('file-list');
    ul.innerHTML='';
    data.entries.forEach(e=>{
        const li = document.createElement('li');
        li.innerText = e.name + (e.is_dir?'/':'');
        li.className = e.is_dir ? 'folder' : 'file';
        if(e.is_dir) li.onclick=()=>listFiles(e.path);
        ul.appendChild(li);
    });
}

async function upload(){
    const fileInput = document.getElementById('upload-file');
    if(fileInput.files.length===0) return alert("Select a file");
    const form = new FormData();
    form.append('file', fileInput.files[0]);
    form.append('path', currentPath);
    await fetch('/files/upload',{method:'POST',body:form});
    await listFiles(currentPath);
}

listFiles(currentPath);
</script>
{% endblock %}
